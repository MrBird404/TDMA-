# TDMA网络协议模拟系统

这是一个基于Go语言实现的TDMA（时分多址）网络协议模拟系统，用于模拟卫星与地面站之间的通信。

## 项目结构

```
tdma-network/
├── cmd/
│   ├── satellite/          # 卫星节点主程序
│   └── groundstation/      # 地面站节点主程序
├── internal/
│   ├── scheduler/          # TDMA调度器
│   └── network/            # 网络接口层
├── pkg/
│   └── protocol/           # 协议定义
├── go.mod
└── README.md
```

## 功能特性

- **TDMA协议实现**：完整的时分多址协议实现
- **时隙调度**：动态时隙分配和管理
- **数据包处理**：TDMA帧的封装、解析和验证
- **网络通信**：基于TCP的网络通信
- **分片支持**：支持大数据包的分片传输
- **实时监控**：系统状态实时监控

## 快速开始

### 1. 编译项目

```bash
go mod tidy
go build ./cmd/satellite
go build ./cmd/groundstation
```

### 2. 启动卫星节点

```bash
./satellite 8080
```

卫星节点将在端口8080上监听连接。

### 3. 启动地面站节点

```bash
./groundstation GROUND_STATION_001 localhost:8080
```

地面站节点将连接到卫星节点。

## 使用说明

### 卫星节点命令

- `status` - 显示节点状态
- `schedule` - 显示当前调度表
- `quit` - 退出程序

### 地面站节点命令

- `send` - 手动发送默认数据
- `status` - 显示节点状态
- `quit` - 退出程序

## TDMA协议说明

### 帧结构

```
+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| Header | SlotID | NodeID | Length | FragID | TotalF | FragIdx| Flags | Data   |
| 8字节   | 4字节   | 16字节  | 4字节   | 4字节   | 2字节   | 2字节   | 2字节   | 变长    |
+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| CRC    | Footer |
| 4字节   | 8字节   |
+--------+--------+
```

### 时隙分配

- 系统支持10个时隙
- 每个时隙持续1秒
- 支持动态时隙分配
- 支持连续时隙分配

### 数据包处理

- 自动CRC校验
- 帧头帧尾验证
- 分片标志位支持
- 序列化/反序列化

## 开发说明

### 添加新功能

1. 在相应的包中添加新功能
2. 更新接口定义
3. 添加测试用例
4. 更新文档

### 扩展协议

1. 修改 `pkg/protocol/tdma_frame.go`
2. 更新序列化/反序列化逻辑
3. 更新验证逻辑
4. 测试兼容性

## 测试

### 单元测试

```bash
go test ./...
```

### 集成测试

1. 启动卫星节点
2. 启动多个地面站节点
3. 观察通信过程

## 性能优化

- 使用对象池减少内存分配
- 批量处理提高吞吐量
- 异步处理减少延迟
- 连接复用提高效率

## 故障排除

### 常见问题

1. **连接失败**：检查端口是否被占用
2. **数据包丢失**：检查网络连接稳定性
3. **时隙冲突**：检查调度器配置
4. **解析错误**：检查帧格式是否正确

### 调试模式

启用详细日志输出：

```bash
export DEBUG=1
./satellite 8080
```

## 许可证

MIT License

## 贡献

欢迎提交Issue和Pull Request来改进这个项目。 